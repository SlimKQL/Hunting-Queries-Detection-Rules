// CVE-2024-43452 PoC Detection

// As the year begins, we've encountered a second significant Windows exploit. A Proof of Concept (PoC) has been released for CVE-2024-43452, a Windows Registry Elevation of Privilege vulnerability (CVSS 7.5) affecting Windows 11 23H2. This PoC, created by Mateusz Jurczyk from Google Project Zero, was inspired by Gabriel Landauâ€™s research on registry vulnerabilities. (Link available in the comments)
// CVE-2024-43452 PoC: https://project-zero.issues.chromium.org/issues/42451731
//Fellow defenders, I have developed an advanced hunting DefenderXDR KQL to detect the use of this PoC with high accuracy. Deploy it wisely to prevent abuse by red teams and threat actors.

let VulnerableEndpoint =
DeviceTvmSoftwareVulnerabilities 
| where CveId == "CVE-2024-43452"
| distinct DeviceName;
let ExeWithLP =
DeviceFileEvents
| where ActionType == @"FileCreated"
| where FileName endswith ".exe"
| invoke FileProfile(SHA1,1000)
| where GlobalPrevalence <= 50
| join kind=leftouter DeviceFileCertificateInfo on SHA1
| where SignatureState == @"Unsigned"
| distinct FileName; // An unsual low prevalence unsigned .exe created
let EPwithCMDRun =
DeviceEvents 
| where InitiatingProcessCommandLine has ".exe" and InitiatingProcessCommandLine has ".dat"
| where FileName has_any(ExeWithLP)
| distinct DeviceName; // Command line execution with low prevalence exe and .dat file
DeviceNetworkEvents
| where RemotePort == "445"
| where ActionType == "ConnectionSuccess"
| where DeviceName has_any (EPwithCMDRun) // Successful outbound SMB connection
| where DeviceName has_any (VulnerableEndpoint) // Not Patch - Vulnerable


// MITRE ATT&CK
